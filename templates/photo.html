<!DOCTYPE html>
<head>
    <title>Over The Glass</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>사진 촬영 및 전송</h1>
    
    <!-- 카메라 접근 권한 요청 및 촬영 버튼 -->
    <input type="file" accept="image/*" capture="camera" id="captureInput">
    <button id="captureButton">촬영하기</button>

    <!-- 이미지 미리보기 -->
    <img src="" id="previewImage" style="display: none;" width="300">

    <!-- 이미지 업로드 버튼 -->
    <button id="uploadButton" style="display: none;">업로드</button>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const captureInput = document.getElementById('captureInput');
            const captureButton = document.getElementById('captureButton');
            const previewImage = document.getElementById('previewImage');
            const uploadButton = document.getElementById('uploadButton');

            // '촬영하기' 버튼 클릭 시 카메라 열기
            captureButton.addEventListener('click', function () {
                captureInput.click();
            });

            // 이미지 선택 시 미리보기 및 업로드 버튼 표시
            captureInput.addEventListener('change', function () {
                const selectedImage = captureInput.files[0];
                if (selectedImage) {
                    const imageURL = URL.createObjectURL(selectedImage);
                    previewImage.src = imageURL;
                    previewImage.style.display = 'block';
                    uploadButton.style.display = 'block';
                }
            });

            // 이미지 업로드 버튼 클릭 시 서버로 전송
            uploadButton.addEventListener('click', function () {
                const selectedImage = captureInput.files[0];
                if (selectedImage) {
                    const formData = new FormData();
                    formData.append('image', selectedImage);

                    // 서버로 이미지 업로드 요청 보내기
                    fetch('/upload', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        // 업로드 완료 후 처리
                        console.log('이미지 업로드 성공');
                        // 추가 작업을 수행하거나 페이지를 리로드할 수 있습니다.
                    })
                    .catch(error => {
                        console.error('이미지 업로드 실패', error);
                    });
                }
            });
        });
    </script>
</body>
</html>